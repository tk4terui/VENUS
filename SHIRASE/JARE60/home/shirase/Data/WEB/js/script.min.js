function initialize(){startObj=new Date(start.y,start.m-1,start.d),latestObj=new Date(latest.y,latest.m-1,latest.d),chgDay(latest.y,latest.m,latest.d),chgImg(),makeTimeSlideBar(),$("#mainimg").on("contextmenu",function(e){e.preventDefault()},!1),$(function(){$("#mainimg").on("mousewheel",function(){return!1}),$("#mainimg").on("mousewheel",wheelFunc),$("#mainimg").on("mousedown",function(){return!1}),$("#mainimg").on("mousedown",mouseOperate),$("#mainimg").on("dblclick",resetImageZoom),$(".multiple-selector .selector input").on("change",function(){$(this).prop("checked")?$(this).parent().addClass("selected",300):$(this).parent().removeClass("selected",300)}),$(".overlay-toggle").sortable({handle:".heading",update:function(){sortOverlay(),zoomImage()}})})}function wheelFunc(e,t){if($("#mainimg").off("mousewheel",wheelFunc),t>0)var a=!0,i=-1;else if(0>t){var n=latest.y,r=latest.m,o=latest.d;10>r&&(r="0"+r),10>o&&(o="0"+o);var s=n+""+r+o,d=document.srch.year.value,l=document.srch.month.value;10>l&&(l="0"+l);var _=document.srch.day.value;10>_&&(_="0"+_);var m=d+""+l+_,a=parseInt(m)<s,i=1}return a?dateCal(i,!1).always(function(){$("#mainimg").on("mousewheel",wheelFunc)}):$("#mainimg").on("mousewheel",wheelFunc),!1}function setLatest(){animStop(),chgDay(latestObj.getFullYear(),latestObj.getMonth()+1,latestObj.getDate()),timeSlide.setAttr({dateNow:latestObj}),timeSlide.updateCalendar("dateCalendar",timeSlide.dateNow),chgImg()}function setDateValue(){var e=parseInt(document.srch.year.value,10),t=parseInt(document.srch.month.value,10),a=parseInt(document.srch.day.value,10);return 10>t&&(t="0"+t),10>a&&(a="0"+a),{y:e,m:t,d:a}}function chgImg(e,t){var a=setDateValue(),i=new Image,n=new $.Deferred;e&&(document.images.baseimg.src="images/loading.gif");var r=a.y+""+a.m+a.d;if(parseInt(r)<=20111003)var o="P1AME";else if(parseInt(r)<=20120723)var o="WNDSI";else var o="AM2SI";var s=$("#selectproduct").val(),d=$("#selectsize").val(),l=document.srch.area.value,_=$("#selectorbit").val();return i.src="data/"+a.y+a.m+"/"+o+r+_+"_"+s+d+"_"+l+"P.png",i.onload=function(){t&&"stop"==$("#dateAnimButton").attr("class")?n.reject():(document.images.baseimg.src=i.src,delete i,updateOverlay().then(function(){n.resolve()}))},i.onerror=function(){delete i,document.images.baseimg.src=noDataImage,updateOverlay().then(function(){n.resolve()})},n.promise()}function switchOverlayToggle(e){var t=new $.Deferred,a=$("#overlay img.original[name='"+e+"']");if($('input.my-switches[name="'+e+'"]').prop("checked")){0===a.size()&&(a=$("<img>").attr("name",e).attr("class","original").attr("width","700").attr("border","0").appendTo("#overlay"));var i,n=$("#selectsize").val();i="C"==n?"Close.png":"M"==n?"Middle.png":"Long.png";var r=new Image;r.src=overlayParam[e]+i,r.onload=function(){a.attr("src",r.src),delete r,sortOverlay(),zoomImage(),t.resolve()},r.onerror=function(){a.attr("src","images/no_data_over.png"),delete r,sortOverlay(),zoomImage(),t.reject()}}else a.size()>0&&a.remove(),sortOverlay(),zoomImage(),setTimeout(function(){t.resolve()},0);return t.promise()}function switchGPV(){return document.srch.gpvtime.value=$(".active input[name='gpvselector']").val(),chgGPV()}function chgGPV(){var e=document.srch.gpvtime.value,t=[];return $(".overlay-toggle input.gpv.my-switches").each(function(){var a=new $.Deferred,i=$(this).attr("name"),n=$("#overlay img.original[name='"+i+"']");if($(this).prop("checked")){0===n.size()&&(n=$("<img>").attr("name",i).attr("class","original").attr("width","700").attr("border","0").appendTo("#overlay"));var r=setDateValue(),o=r.y+""+r.m+r.d,s=$("#selectsize").val(),d=document.srch.area.value,l="data/"+r.y+r.m+"/GPV"+o+"00FD"+e+"00_"+i+s+"_"+d+"P.png",_=new Image;_.src=l,_.onload=function(){n.attr("src",_.src),delete _,a.resolve()},_.onerror=function(){n.attr("src","images/no_data_over.png"),delete _,a.reject()}}else n.size()>0&&n.remove(),setTimeout(function(){a.resolve()});t.push(a)}),$.when.apply(null,t).always(function(){sortOverlay(),zoomImage()})}function updateOverlay(){var e=new $.Deferred;return $.when.apply(null,[switchOverlayToggle("floor"),switchOverlayToggle("track"),chgGPV()]).then(function(){zoomImage(),e.resolve()},function(){e.reject()}),e.promise()}function sortOverlay(){var e=0;$(".overlay-toggle input.my-switches").each(function(t){if($(this).prop("checked")){var a=$(this).attr("name");$("#overlay img.original[name='"+a+"']").attr("data-order",e++)}}),$("#overlay").html($("#overlay > img.original").sort(function(e,t){return parseInt($(t).attr("data-order"),10)-parseInt($(e).attr("data-order"),10)}))}function chgDay(e,t,a){var i="srch",n=parseInt(e,10),r=parseInt(t,10),o=parseInt(a,10);if("4"==r||"6"==r||"9"==r||"11"==r)var s=30;else if("2"==r)if(n%4!=0||n%100==0&&n%400!=0)var s=28;else var s=29;else var s=31;var d=document.forms[i].year,l=latestObj.getFullYear();d.options.length=parseInt(l-start.y+1,10);for(var _=0,m=start.y;l>=m;m++)d.options[_].value=m,d.options[_].text=m,d.options[_].value==n&&(d.options[_].selected=!0),_++;var d=document.forms[i].month;d.options.length=12;for(var m=0;12>m;m++)d.options[m].value=m+1,d.options[m].text=m+1,d.options[m].value==r&&(d.options[m].selected=!0);var d=document.forms[i].day;for(d.options.length=s,m=0;s>m;m++)d.options[m].value=m+1,d.options[m].text=m+1,d.options[m].value==o&&(d.options[m].selected=!0)}function dateCal(e,t,a){var i=parseInt(document.srch.year.value,10),n=parseInt(document.srch.month.value,10),r=parseInt(document.srch.day.value,10),o=new $.Deferred;a||animStop();var s=new Date(i,n-1,r+parseInt(e,10));if(0>s-startObj||s-latestObj>0)return o.reject(),o.promise();var d=s.getFullYear(),l=s.getMonth()+1,_=s.getDate();return document.srch.year.value=d,document.srch.month.value=l,document.srch.day.value=_,chgDay(d,l,_),chgImg(t,a).then(function(){timeSlide.setAttr({dateNow:new Date(d,l-1,_)}),timeSlide.updateCalendar("dateCalendar",timeSlide.dateNow)}).always(function(){o.resolve()}),o.promise()}function latlon2xy(e,t){var a=(t-lonRegion[0])/(lonRegion[1]-lonRegion[0]),i=Math.log(Math.tan(Math.PI*(e+90)/360)),n=Math.log(Math.tan(Math.PI*(latRegion[0]+90)/360)),r=Math.log(Math.tan(Math.PI*(latRegion[1]+90)/360)),o=(i-n)/(r-n),s=xRegion[0]+a*(xRegion[1]-xRegion[0]),d=yRegion[0]+o*(yRegion[1]-yRegion[0]),l=Math.floor((s-imageZoomParam.dx)*imageZoomParam.rx),_=Math.floor((d-imageZoomParam.dy)*imageZoomParam.ry);return[l,_]}function mouseOperate(e){function t(e){var t=e.clientX-n.left,a=e.clientY-n.top;if(1==i){var r=(t-o.x)/imageZoomParam.rx,c=(a-o.y)/imageZoomParam.ry,h=imageZoomArea.xr-imageZoomArea.xl,u=imageZoomArea.yb-imageZoomArea.yt;r=Math.max(Math.min(r,imageZoomParam.dx),imageZoomParam.dx-h*(1-1/imageZoomParam.rx)),c=Math.max(Math.min(c,imageZoomParam.dy),imageZoomParam.dy-u*(1-1/imageZoomParam.ry)),imageZoomParam.dx=imageZoomParam.dx-r,imageZoomParam.dy=imageZoomParam.dy-c,o.x=t,o.y=a,zoomImage()}else{if(imageZoomParam.rfix){var g=Math.max(Math.abs(t-o.x),Math.abs(a-o.y));if(t=o.x+(t-o.x)/Math.abs(t-o.x)*g,a=o.y+(a-o.y)/Math.abs(a-o.y)*g,t<imageZoomArea.xl||t>imageZoomArea.xr){t=Math.min(Math.max(t,imageZoomArea.xl),imageZoomArea.xr);var g=Math.abs(t-o.x);a=o.y+(a-o.y)/Math.abs(a-o.y)*g}if(a<imageZoomArea.yt||a>imageZoomArea.yb){a=Math.min(Math.max(a,imageZoomArea.yt),imageZoomArea.yb);var g=Math.abs(a-o.y);t=o.x+(t-o.x)/Math.abs(t-o.x)*g}}d=Math.min(Math.max(Math.min(o.x,t),imageZoomArea.xl),imageZoomArea.xr),l=Math.min(Math.max(Math.max(o.x,t),imageZoomArea.xl),imageZoomArea.xr),_=Math.min(Math.max(Math.min(o.y,a),imageZoomArea.yt),imageZoomArea.yb),m=Math.min(Math.max(Math.max(o.y,a),imageZoomArea.yt),imageZoomArea.yb),s.css({left:d-1,top:_-1,width:l-d-2,height:m-_-2})}}function a(){if(2==i&&d&&l&&_&&m){var e=imageZoomArea.xr-imageZoomArea.xl,n=imageZoomArea.yb-imageZoomArea.yt,r=(d-imageZoomArea.xl)/imageZoomParam.rx,o=(_-imageZoomArea.yt)/imageZoomParam.ry,c=e/(l-d),h=n/(m-_);if(imageZoomParam.rfix){var u=Math.max(c,h);c=u,h=u}imageZoomParam.rx=imageZoomParam.rx*c,imageZoomParam.ry=imageZoomParam.ry*h,imageZoomParam.dx=imageZoomParam.dx+r,imageZoomParam.dy=imageZoomParam.dy+o,zoomImage()}$(document).off("mousemove",t),$(document).off("mouseup",a),$(document).off("mouseup"),2==i&&s.remove()}if(0==e.button)if(e.ctrlKey)var i=1;else var i=2;else{if(2!=e.button)return!1;var i=1}var n=$("#mainimg")[0].getBoundingClientRect(),r={x:e.clientX,y:e.clientY},o={x:r.x-n.left,y:r.y-n.top};if(2==i){var s=$('<div id="zoomrect">').css({position:"absolute",border:"solid 2px black",width:0,height:0,"z-index":50});$("#mainimg").append(s)}$(document).on("mousemove",function(){return!1}),$(document).on("mouseup",function(){return!1}),$(document).on("mousemove",t),$(document).on("mouseup",a);var d,l,_,m}function zoomImage(){$("#mainimg #copy").css({display:"block",width:imageZoomArea.xr-imageZoomArea.xl,height:imageZoomArea.yb-imageZoomArea.yt,left:imageZoomArea.xl,top:imageZoomArea.yt,overflow:"hidden",position:"absolute",margin:0,offset:0});var e=$("#base img").width(),t=$("#base img").height(),a=Math.floor(e*imageZoomParam.rx),i=Math.floor(t*imageZoomParam.ry),n=-Math.floor((imageZoomArea.xl+imageZoomParam.dx)*imageZoomParam.rx),r=-Math.floor((imageZoomArea.yt+imageZoomParam.dy)*imageZoomParam.ry),o={},s=0;$("#mainimg img.original").each(function(){var e=$(this).attr("name");o[e+"-copy"]=!0;var t=$("#mainimg #copy img.copy[name='"+e+"-copy']");0===t.size()&&(t=$("<img>").attr("class","copy").attr("name",e+"-copy").appendTo($("#mainimg #copy"))),t.css({position:"absolute",left:n,top:r,width:a,height:i,"z-index":10+s++}).attr("src",$(this).attr("src")),"baseimg"==e&&t.css("z-index",9)}),$("#mainimg #copy img.copy").each(function(){$image=$(this);var e=$image.attr("name");e in o||$image.remove()})}function resetImageZoom(){imageZoomParam={dx:0,dy:0,rx:1,ry:1,rfix:!0},$("#mainimg #copy").empty(),$("#base").show()}function makeTimeSlideBar(){function e(e,t,a){e.stopPropagation(),$("#"+t).toggle(a)}function t(){$("#dateCalendar").hide(s)}function a(e){timeSlide.setAttr({dateNow:e}),timeSlide.dateNow-startObj<0?(timeSlide.setAttr({dateNow:startObj}),$("div#selectdate select[name='year']").val(timeSlide.dateNow.getFullYear()),$("div#selectdate select[name='month']").val(timeSlide.dateNow.getMonth()+1),$("div#selectdate select[name='day']").val(timeSlide.dateNow.getDate())):timeSlide.dateNow-latestObj>0&&(timeSlide.setAttr({dateNow:latestObj}),$("div#selectdate select[name='year']").val(timeSlide.dateNow.getFullYear()),$("div#selectdate select[name='month']").val(timeSlide.dateNow.getMonth()+1),$("div#selectdate select[name='day']").val(timeSlide.dateNow.getDate())),i()}function i(){animStop();var e=timeSlide.__dateFormat__(timeSlide.dateNow,"yyyy"),t=timeSlide.__dateFormat__(timeSlide.dateNow,"MM"),a=timeSlide.__dateFormat__(timeSlide.dateNow,"dd");$("div#selectdate select[name='year']").val(e),$("div#selectdate select[name='month']").val(t),$("div#selectdate select[name='day']").val(a),timeSlide.updateCalendar("dateCalendar",timeSlide.dateNow),chgDay(e,t,a),chgImg(!0)}var n=startObj,r=latestObj,o=r;timeSlide=new TimeSlideBar("timeSlideBar",n,r,{dateNow:o,dateLControl:null,dateRControl:null,axisTicksTxtFormat:[[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%b"),function(e){return e.getMonth()}],[d3.time.format("%m/%d"),function(e){return 1!=e.getDate()}],[d3.time.format("%d"),function(e){return e.getDay()&&1!=e.getDate()}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]],axisTicksTxtAnchor:"center",axisTicksNum:4}),timeSlide.makeAxis("timeSlideAxis"),timeSlide.makeCalendar("dateCalendar",o,[0,0,1,0,0,0]),$("#dateCalendar").hide(),$("#dateCalendar").click(function(e){e.stopPropagation()});var s=100;$("#dateCalendarIcon").on("click",function(t){e(t,"dateCalendar",s)}),timeSlide.onchangeCalendar("dateCalendar",function(e){timeSlide.setAttr({dateNow:e}),$("#dateCalendar").hide(s),i()}),$(document).on("click",t),timeSlide.onmouseup(function(){i()}),$("div#selectdate select[name='year']").on("change",function(){var e=timeSlide.__dateParse__(this.value,"yyyy",timeSlide.dateNow);a(e)}),$("div#selectdate select[name='month']").on("change",function(){var e=timeSlide.__dateParse__(this.value,"MM",timeSlide.dateNow);a(e)}),$("div#selectdate select[name='day']").on("change",function(){var e=timeSlide.__dateParse__(this.value,"dd",timeSlide.dateNow);a(e)})}function animStart(e){if(animStop(),1==e){$("#dateAnimButton").attr("class","forward");var t=$("#startButton"),a=$("#backButton")}else{$("#dateAnimButton").attr("class","backward");var t=$("#backButton"),a=$("#startButton")}t.attr("disabled","disabled").css("background-color","hotpink"),a.removeAttr("disabled").css("background-color",""),animStep(e)}function animStep(e){"stop"!=$("#dateAnimButton").attr("class")&&dateCal(e,!1,!0).then(function(){var t=$("#dateAnimButton").attr("class");(1==e&&"forward"==t||-1==e&&"backward"==t)&&(timeAnim=setTimeout(function(){animStep(e)},animDelayTime))},function(){animStop()})}function animStop(){clearTimeout(timeAnim),$("#dateAnimButton").attr("class","stop"),$(".animButton").removeAttr("disabled").css("background-color","")}function animSpeed(e){var t=100;animDelayTime==t&&1==e||t>animDelayTime?animDelayTime*=Math.pow(2,-e):animDelayTime-=e*t,animDelayTime=Math.max(animDelayTime,6.25)}function makeSavePopup(e){function t(e){0>=saveTe-saveTs&&("s"==e?saveTe=new Date(saveTs-0+864e5):saveTs=new Date(saveTe-0-864e5)),saveTe-latestObj>0&&(saveTe=latestObj,saveTs-(latestObj-864e5)>0&&(saveTs=new Date(latestObj-864e5))),0>saveTs-startObj&&(saveTs=startObj,0>saveTe-(startObj+864e5)&&(saveTe=new Date(startObj-0+864e5))),timeSlide.updateCalendar("saveTimeStartCalendar",saveTs),timeSlide.updateCalendar("saveTimeEndCalendar",saveTe);var t=saveTs.getFullYear(),a=saveTs.getMonth()+1,i=saveTs.getDate(),o=saveTe.getFullYear(),s=saveTe.getMonth()+1,d=saveTe.getDate();if(n(t,a,i,"s"),n(o,s,d,"e"),filenameFlg){var l=fileExtensions[fileFormatNum],_=timeSlide.__dateFormat__(saveTs,"yyyyMMdd"),m=timeSlide.__dateFormat__(saveTe,"yyyyMMdd"),c=setVarName();document.save.fname.value="vishop_"+c+"_"+_+"_"+m+"."+l}r()}function a(e,t,a){e.stopPropagation(),$("#"+t).toggle(a)}function i(e){$("#saveTimeStartCalendar").hide(e),$("#saveTimeEndCalendar").hide(e)}function n(e,t,a,i){var n,r,o=parseInt(e,10),s=parseInt(t,10),d=parseInt(a,10),l=0;r="4"==s||"6"==s||"9"==s||"11"==s?30:"2"==s?o%4!=0||o%100==0&&o%400!=0?28:29:31,n=document.save["yy"+i];var _=latestObj.getFullYear(),m=startObj.getFullYear();for(n.options.length=parseInt(_-m+1,10),x=m;_>=x;x++)n.options[l].value=x,n.options[l].text=x,n.options[l].value==o&&(n.options[l].selected=!0),l++;for(n=document.save["mm"+i],n.options.length=12,x=0;12>x;x++)n.options[x].value=x+1,n.options[x].text=x+1,n.options[x].value==s&&(n.options[x].selected=!0);for(n=document.save["dd"+i],n.options.length=r,x=0;r>x;x++)n.options[x].value=x+1,n.options[x].text=x+1,n.options[x].value==d&&(n.options[x].selected=!0)}function r(){var e=(saveTe-saveTs)/864e5+1,t=document.save.frate.value,a=e/t;if(a>=.01){var i=1-Math.floor(Math.min(Math.max(Math.log(a)*Math.LOG10E,-1),1));a=a.toFixed(i)}else a=a.toPrecision(1);switch(document.srch.lang.value){case"e":$("#saveLog").text("total : "+e+" frame ["+a+" sec]");break;case"j":$("#saveLog").text("total : "+e+" フレーム ["+a+" 秒]")}}saveMode=e,$("#gray_panel").show(),$("#popupWindow").show(),$("#gray_panel").on("click",finishSavePopup);var o=$("#mainimg"),s=o.offset().left,d=o.offset().top,l=o.outerWidth(!0),_=o.outerHeight(!0);$("#popupWindow").css("left",s).css("top",d).css("width",l).css("height",_);var m=$("#popupWindow > div").outerHeight(!0);if($("#popupWindow > div").css("top",.5*(_-m)),filenameFlg=!0,2==saveMode){if($("#saveTimeSpanDiv").hide(),$("#saveFormatDiv").hide(),filenameFlg){var c="png",h=parseInt(document.srch.year.value),u=parseInt(document.srch.month.value),g=parseInt(document.srch.day.value);document.save.fname.value="vishop_"+h+u+g+"."+c}}else{$("#saveTimeSpanDiv").show(),$("#saveFormatDiv").show();var v=parseInt(document.srch.year.value),f=parseInt(document.srch.month.value),p=parseInt(document.srch.day.value),y=latestObj.getFullYear(),S=latestObj.getMonth()+1,T=latestObj.getDate();saveTs=new Date(v,f-1,p),saveTe=latestObj;var v=saveTs.getFullYear(),f=saveTs.getMonth()+1,p=saveTs.getDate(),y=saveTe.getFullYear(),S=saveTe.getMonth()+1,T=saveTe.getDate();if(n(v,f,p,"s"),n(y,S,T,"e"),first){for(var x=0;x<fileFormats.length;x++)$("<option>").text(fileFormats[x]).appendTo($("#saveFormatDiv select"));timeSlide.makeCalendar("saveTimeStartCalendar",saveTs,[0,0,1,0,0,0]),timeSlide.makeCalendar("saveTimeEndCalendar",saveTe,[0,0,1,0,0,0]),$("#saveTimeStartCalendar").hide(),$("#saveTimeEndCalendar").hide(),$("#saveTimeStartCalendar").click(function(e){e.stopPropagation()}),$("#saveTimeEndCalendar").click(function(e){e.stopPropagation()}),$(document).on("click",function(){i(100)}),timeSlide.onchangeCalendar("saveTimeStartCalendar",function(e){saveTs=e,t("s"),i(100)}),timeSlide.onchangeCalendar("saveTimeEndCalendar",function(e){saveTe=e,t("e"),i(100)}),$("div#saveTimeStart select[name='yys']").on("change",function(){saveTs=timeSlide.__dateParse__(this.value,"yyyy",saveTs),t("s")}),$("div#saveTimeStart select[name='mms']").on("change",function(){saveTs=timeSlide.__dateParse__(this.value,"MM",saveTs),t("s")}),$("div#saveTimeStart select[name='dds']").on("change",function(){saveTs=timeSlide.__dateParse__(this.value,"dd",saveTs),t("s")}),$("div#saveTimeEnd select[name='yye']").on("change",function(){saveTe=timeSlide.__dateParse__(this.value,"yyyy",saveTe),t("e")}),$("div#saveTimeEnd select[name='mme']").on("change",function(){saveTe=timeSlide.__dateParse__(this.value,"MM",saveTe),t("e")}),$("div#saveTimeEnd select[name='dde']").on("change",function(){saveTe=timeSlide.__dateParse__(this.value,"dd",saveTe),t("e")}),$("#saveFormatDiv select").on("change",function(){fileFormatNum=parseInt(document.save.fileFormat.selectedIndex),t()}),$("#saveFrameRateDiv input").on("change",function(){r()}),$("#saveFileNameDiv input").on("change",function(){filenameFlg=!1}),first=!1}else timeSlide.updateCalendar("saveTimeStartCalendar",saveTs),timeSlide.updateCalendar("saveTimeEndCalendar",saveTe);$("#saveTimeStartCalendarIcon").on("click",function(e){a(e,"saveTimeStartCalendar",100)}),$("#saveTimeEndCalendarIcon").on("click",function(e){a(e,"saveTimeEndCalendar",100)}),t("e")}document.save.width.value=$("div#mainimg").width(),document.save.frate.value=10}function setSave(){disableSaveButtons(),$("#gray_panel").off("click");var e=document.save.fname.value,t=parseInt(document.save.width.value);if(1==saveMode){var a=parseInt(document.save.frate.value),i=$("#saveProgress progress")[0];i.value=0,i.max=(saveTe-saveTs)/864e5+1;var n="Drawing Frames : 0 / "+i.max+" [0%]";$("#saveProgress div").text(n),$("#saveProgress").show(),flgSaveAnimation=!0,saveAnimation(e,a,t,saveTs,saveTe,i,finishSavePopup)}else saveImage(e,t,finishSavePopup)}function finishSavePopup(){$("#saveProgress").hide(),$("#gray_panel").hide(),$("#popupWindow").hide(),enableSaveButtons()}function disableSaveButtons(){$("#popupWindow input").attr("disabled","disabled"),$("#popupWindow select").attr("disabled","disabled"),$("#saveCancel").removeAttr("disabled"),$("#saveTimeStartCalendarIcon").off("click"),$("#saveTimeEndCalendarIcon").off("click")}function enableSaveButtons(){$("#popupWindow input").removeAttr("disabled","disabled"),$("#popupWindow select").removeAttr("disabled","disabled")}function saveImage(e,t,a){function i(e){for(var t="image/png",i=$("#saveCanvas")[0].toDataURL(t),n=atob(i.split(",")[1]),r=new Uint8Array(n.length),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);var s=new Blob([r.buffer],{type:t}),i=window.URL.createObjectURL(s),d=e.split(".");"png"!=d[d.length-1]&&(e+=".png");var l=d3.select("body").append("a").attr("download",e).attr("href",i).style("display","none");l.node().click(),setTimeout(function(){window.URL.revokeObjectURL(i),l.remove(),a()},10)}if(""==e)return alert("please input file name"),!1;var n=$("#saveCanvas")[0].getContext("2d"),r=t;n.canvas.width=t,n.canvas.height=r,setImage(t,r).then(function(){i(e)})}function saveAnimation(e,t,a,i,n,r,o){function s(e,t){if(!flgSaveAnimation)return void clearTimeout(l);var a=new Date(i-0+24*r.value*3600*1e3),n=a.getFullYear(),o=a.getMonth()+1,m=a.getDate();console.log(n,o,m),chgDay(n,o,m),chgImg(!0).then(function(){return setImage(e,t)}).then(function(){r.value++;var a=Math.round(r.value/r.max*100),i="Drawing Frames : "+r.value+" / "+r.max+" ["+a+"%]";$("#saveProgress div").text(i),"WebM"==fileFormats[fileFormatNum]?c.add(_):"GIF"==fileFormats[fileFormatNum]&&c.addFrame(_),r.value<r.max?l=setTimeout(function(){s(e,t)},10):d()})}function d(){if($("#saveProgress div").text("Compliing Video"),"WebM"==fileFormats[fileFormatNum])var t=c.compile();else if("GIF"==fileFormats[fileFormatNum])var a=new Uint8Array(c.stream().bin),t=new Blob([a.buffer],{type:"image/gif"});var i=webkitURL.createObjectURL(t),n=fileExtensions[fileFormatNum],r=e.split(".");r[r.length-1]!=n&&(e+=n);var s=d3.select("body").append("a").attr("download",e).attr("href",i).style("display","none");s.node().click(),chgDay(h,u,g),chgImg(!0),setTimeout(function(){window.URL.revokeObjectURL(i),s.remove(),o()},10)}var l;if(""==e)return alert("please input file name"),!1;var _=$("#saveCanvas")[0].getContext("2d"),m=a;if(_.canvas.width=a,_.canvas.height=m,"WebM"==fileFormats[fileFormatNum])var c=new Whammy.Video(t);else if("GIF"==fileFormats[fileFormatNum]){var c=new GIFEncoder;c.setRepeat(0),c.setDelay(1e3/t),c.setSize(a,m),c.start()}var h=parseInt(document.srch.year.value),u=parseInt(document.srch.month.value),g=parseInt(document.srch.day.value);s(a,m)}function setImage(e,t){var a=new $.Deferred;return html2canvas(document.getElementById("mainimg"),{onrendered:function(i){var n=i.width,r=i.height,o=$("#saveCanvas")[0].getContext("2d");o.drawImage(i,0,0,n,r,0,0,e,t),a.resolve()}}),a.promise()}function stopSave(){flgSaveAnimation=!1,finishSavePopup()}function setVarName(){var e=document.srch.base.length;for(i=0;i<e;i++)if(document.srch.base[i].checked)var t=document.srch.base[i].value;return t}function setExtension(){return"png"}var startObj,latestObj,shwmsg=["Overlay","Displaying"],noDataImage="images/no_data_base.png",overlayParam={floor:"data/depth/",track:"data/track/"},imageZoomArea={xl:0,xr:700,yt:0,yb:700},imageZoomParam={dx:0,dy:0,rx:1,ry:1,rfix:!0},lonRegion=[20,140],latRegion=[-75,-45],xRegion=[68,632],yRegion=[478,170];window.onload=initialize;var timeSlide,timeAnim,animDelayTime=100,TimeSlideBar=function(e,t,a,i){this.__init__(e,t,a,i)};TimeSlideBar.prototype={_axisArea:null,_dateNowFlg:!1,_dateSelectFlg:!1,_parentArea:null,_innerArea:null,_startTimeWidget:null,_endTimeWidget:null,_nowTimeWidget:null,_selectAreaWidget:null,_innerAreaHammer:null,_calendar:[],_eventFunc:[],dateMin:null,dateMax:null,dateLControl:null,dateRControl:null,dateStart:null,dateEnd:null,dateNow:null,timeInterval:[0,0,0,0,0,1],parentAreaLeft:0,parentAreaTop:0,parentAreaWidth:0,parentAreaHeight:0,axisTicksOrient:"bottom",axisTicksNum:8,axisTicksTxtFormat:null,axisTicksTxtRotate:0,axisTicksTxtAnchor:null,axisTicksTxtDX:null,axisTicksTxtDY:null,baseZIndex:1,update:function(e,t){this.__timeCondition__(e),this._dateSelectFlg||null==this.dateStart||null==this.dateEnd?!this._dateSelectFlg||null!=this.dateStart&&null!=this.dateEnd||this.__deleteSelectTimeWidget__():this.__makeSelectTimeWidget__(),this._dateNowFlg||null==this.dateNow?this._dateNowFlg&&null==this.dateNow&&this.__deleteNowTimeWidget__():this.__makeNowTimeWidget__(),this.__updateEventFunc__(),this._dateSelectFlg||null==this.dateStart||null==this.dateEnd?!this._dateSelectFlg||null!=this.dateStart&&null!=this.dateEnd||(this._dateSelectFlg=!1):this._dateSelectFlg=!0,this._dateNowFlg||null==this.dateNow?this._dateNowFlg&&null==this.dateNow&&(this._dateNowFlg=!1):this._dateNowFlg=!0,this.__updateLRControlWidget__(),this.__setSlideWidgetPosition__(t),this._axisArea&&this.__updateAxis__(t)},getAttr:function(e){return this[e]},setAttr:function(e){var t=0;for(var a in e)this[a]=e[a],"dateStart"==a&&(t+=1),"dateEnd"==a&&(t-=1);this.update(t)},on:function(e,t,a){this.__addEventListener__(e,t,a)},off:function(e,t){this.__removeEventListener__(e,t)},onchange:function(e,t){this.on("change",e,t)},onmouseup:function(e,t){this.on("mouseup",e,t)},onmousedown:function(e,t){this.on("mousedown",e,t)},onmousemove:function(e,t){this.on("mousemove",e,t)},onclick:function(e,t){this.on("click",e,t)},makeAxis:function(e){this.__makeAxis__(e)},makeCalendar:function(e,t,a){this.__makeCalendar__(e,t,this.dateMin,this.dateMax,a)},onchangeCalendar:function(e,t){this._calendar[e].onchangeFunc=t},onchangeCalendarDate:function(e,t){this._calendar[e].onchangeDateFunc=t},onchangeCalendarTime:function(e,t){this._calendar[e].onchangeTimeFunc=t},updateCalendar:function(e,t){null!=t&&this.__updateCalendar__(e,t)},__timeFormat__:function(e){return function(t){for(var a=e.length-1,i=e[a];!i[1](t);)i=e[--a];return i[0](t)}},__init__:function(e,t,a,i){this.dateMin=t,this.dateMax=a;var n=[[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%b"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return 1!=e.getDate()}],[d3.time.format("%d"),function(e){return e.getDay()&&1!=e.getDate()}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]];this.axisTicksTxtFormat=n;for(var r in i)this[r]=i[r];i&&(this._dateNowFlg=null!=i.dateNow,this._dateSelectFlg=null!=i.dateStart&&null!=i.dateEnd),null==this.dateLControl&&(this._dateSelectFlg?this.dateLControl=new Date(2*this.dateStart-this.dateEnd):this.dateLControl=this.dateMin),null==this.dateRControl&&(this._dateSelectFlg?this.dateRControl=new Date(2*this.dateEnd-this.dateStart):this.dateRControl=this.dateMax),this.__timeCondition__(),this._parentArea=$("#"+e),this.parentAreaLeft=this._parentArea.offset().left,this.parentAreaTop=this._parentArea.offset().top,this.parentAreaWidth=Math.floor(parseInt(document.defaultView.getComputedStyle(this._parentArea[0],null).getPropertyValue("width"))),this.parentAreaHeight=Math.floor(parseInt(document.defaultView.getComputedStyle(this._parentArea[0],null).getPropertyValue("height"))),this._eventFunc[0]=[],this._eventFunc.change=[],this._eventFunc.mouseup=[],this._eventFunc.mousedown=[],this._eventFunc.mousemove=[],this._eventFunc.click=[],this.__make__()},__timeCondition__:function(e){if(this.__setTimeInterval__(),this.dateLControl-this.dateMin<0&&(this.dateLControl=this.dateMin),this.dateRControl-this.dateMax>0&&(this.dateRControl=this.dateMax),this._dateSelectFlg&&null!=this.dateStart&&null!=this.dateEnd&&(this.dateStart-this.dateMin<0&&(this.dateStart=this.dateMin),this.dateEnd-this.dateMax>0&&(this.dateEnd=this.dateMax),this.dateStart-this.dateLControl<0&&(this.dateLControl=this.dateStart),this.dateEnd-this.dateRControl>0&&(this.dateRControl=this.dateEnd),this.dateStart-this.dateEnd>0&&(1==e?this.dateStart=this.dateEnd:this.dateEnd=this.dateStart)),this._dateNowFlg&&null!=this.dateNow){if(this.dateLControl>this.dateNow&&(this.dateLControl=this.dateNow),this.dateRControl<this.dateNow&&(this.dateRControl=this.dateNow),this._dateSelectFlg)var t=this.dateStart,a=this.dateEnd;else var t=this.dateLControl,a=this.dateRControl;this.dateNow-t<0&&(this.dateNow=t),this.dateNow-a>0&&(this.dateNow=a)}},__setTimeInterval__:function(){var e=this.timeInterval[5]+60*(this.timeInterval[4]+60*(this.timeInterval[3]+24*this.timeInterval[2]));(0!=this.timeInterval[0]||0!=this.timeInterval[1]||0!=e)&&(this.dateLControl=this.__setTimeIntervalSet__(this.dateMin,this.dateLControl,this.timeInterval),this.dateRControl=this.__setTimeIntervalSet__(this.dateMin,this.dateRControl,this.timeInterval),null!=this.dateStart&&(this.dateStart=this.__setTimeIntervalSet__(this.dateMin,this.dateStart,this.timeInterval)),null!=this.dateEnd&&(this.dateEnd=this.__setTimeIntervalSet__(this.dateMin,this.dateEnd,this.timeInterval)),this.dateNow=this.__setTimeIntervalSet__(this.dateMin,this.dateNow,this.timeInterval))},__make__:function(){this._parentArea.css("position","relative");var e=$(this.__jQuery_create__("div",{id:"timeSlideContentsWrap","class":"timeSlideWrap"})),t=$(this.__jQuery_create__("div",{id:"timeSlideMainContentsWrap","class":"timeSlideWrap"})),a=$(this.__jQuery_create__("div",{id:"timeSlideLControlWidget","class":"timeSlideBox"})),i=$(this.__jQuery_create__("div",{id:"timeSlideRControlWidget","class":"timeSlideBox"})),n=$(this.__jQuery_create__("div",{id:"timeSlideWidget","class":"timeSlideBox"})),r=$(this.__jQuery_create__("div",{id:"timeSlideLControlPlus","class":"timeSlideControl"})),o=$(this.__jQuery_create__("div",{id:"timeSlideLControlMinus","class":"timeSlideControl"})),s=$(this.__jQuery_create__("div",{id:"timeSlideRControlPlus","class":"timeSlideControl"})),d=$(this.__jQuery_create__("div",{id:"timeSlideRControlMinus","class":"timeSlideControl"}));this._parentArea.append(e),this._parentArea.append(i),e.append(t),e.append(a),t.append(n),a.append(o),a.append(r),i.append(d),i.append(s),this._innerArea=n,this._innerArea.hammer&&(this._innerAreaHammer=this._innerArea.hammer({transform_always_block:!0,transform_min_scale:1,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0}));var l=Math.floor(this.parentAreaWidth),_=Math.floor(this.parentAreaHeight),m=o.width(),c=r.width(),h=d.width(),u=s.width(),g=m+c,v=h+u,f=l-g-v;this.__jQuery_setCSS__(e,{height:_+"px",width:l+"px","float":"left","margin-right":"-"+v+"px"}),this.__jQuery_setCSS__(t,{height:_+"px",width:l+"px","float":"right","margin-left":"-"+g+"px"}),this.__jQuery_setCSS__(a,{height:_+"px",width:g+"px","float":"left"}),this.__jQuery_setCSS__(i,{height:_+"px",width:v+"px","float":"right"}),this.__jQuery_setCSS__(this._innerArea,{height:_+"px",width:f+"px",position:"relative","margin-left":g+"px","margin-right":v+"px","z-index":this.baseZIndex+1}),this.__jQuery_setCSS__(o,{height:_+"px",width:m+"px","float":"left"}),this.__jQuery_setCSS__(r,{height:_+"px",width:c+"px","float":"left"}),this.__jQuery_setCSS__(d,{height:_+"px",width:h+"px","float":"left"}),this.__jQuery_setCSS__(s,{height:_+"px",width:u+"px","float":"left"}),this._dateSelectFlg&&this.__makeSelectTimeWidget__(),this._dateNowFlg&&this.__makeNowTimeWidget__(),this.__setSlideWidgetPosition__(),this.__setSlideWidgetMove__(),this.__makeLRControlWidget__()},__makeSelectTimeWidget__:function(){this._startTimeWidget=$(this.__jQuery_create__("div",{id:"timeSlideStartDate","class":"timeSlideItem"})),this._endTimeWidget=$(this.__jQuery_create__("div",{id:"timeSlideEndDate","class":"timeSlideItem"})),this._selectAreaWidget=$(this.__jQuery_create__("div",{id:"timeSlideSelect","class":"timeSlideItem"})),this._innerArea.append(this._startTimeWidget),this._innerArea.append(this._endTimeWidget),this._innerArea.append(this._selectAreaWidget),this._startTimeWidget.css("z-index",this.baseZIndex+3),this._endTimeWidget.css("z-index",this.baseZIndex+3),this._selectAreaWidget.css("z-index",this.baseZIndex+2),$(".timeSlideItem").css("position","absolute")},__makeNowTimeWidget__:function(){this._nowTimeWidget=$(this.__jQuery_create__("div",{id:"timeSlideNowDate","class":"timeSlideItem"})),this._innerArea.append(this._nowTimeWidget),this._nowTimeWidget.css("position","absolute"),this._nowTimeWidget.css("z-index",this.baseZIndex+4)},__makeLRControlWidget__:function(){var e=this;e._lControlPWidget=$("#timeSlideLControlPlus"),e._lControlMWidget=$("#timeSlideLControlMinus"),e._rControlPWidget=$("#timeSlideRControlPlus"),e._rControlMWidget=$("#timeSlideRControlMinus"),e._lControlPWidget.css("z-index",e.baseZIndex+4),
e._lControlMWidget.css("z-index",e.baseZIndex+4),e._rControlPWidget.css("z-index",e.baseZIndex+4),e._rControlMWidget.css("z-index",e.baseZIndex+4),e._lControlMWidget.bind("contextmenu",function(){return!1}),e._lControlPWidget.bind("contextmenu",function(){return!1}),e._rControlMWidget.bind("contextmenu",function(){return!1}),e._rControlPWidget.bind("contextmenu",function(){return!1}),e._lControlMWidget.on("click",function(){e.__changeLRControl__(e,-1,-1)}),e._lControlPWidget.on("click",function(){e.__changeLRControl__(e,-1,1)}),e._rControlMWidget.on("click",function(){e.__changeLRControl__(e,1,-1)}),e._rControlPWidget.on("click",function(){e.__changeLRControl__(e,1,1)}),this.__updateLRControlWidget__()},__updateLRControlWidget__:function(){this._lControlMWidget.attr("class","timeSlideControl"),this._lControlPWidget.attr("class","timeSlideControl"),this._rControlMWidget.attr("class","timeSlideControl"),this._rControlPWidget.attr("class","timeSlideControl"),this.dateLControl-this.dateMin==0&&this._lControlMWidget.attr("class","timeSlideControl off"),this.dateLControl-this.dateStart==0&&this._lControlPWidget.attr("class","timeSlideControl off"),this.dateRControl-this.dateEnd==0&&this._rControlMWidget.attr("class","timeSlideControl off"),this.dateRControl-this.dateMax==0&&this._rControlPWidget.attr("class","timeSlideControl off")},__changeLRControl__:function(e,t,a){var i=e.dateLControl.getTime(),n=e.dateRControl.getTime(),r=n-i;-1==t?-1==a?e.dateLControl=new Date(i-r/2):e.dateLControl=new Date(i+r/2):-1==a?e.dateRControl=new Date(n-r/2):e.dateRControl=new Date(n+r),e.update(null,500)},__deleteSelectTimeWidget__:function(){this._startTimeWidget.remove(),this._endTimeWidget.remove(),this._selectAreaWidget.remove()},__deleteNowTimeWidget__:function(){this._nowTimeWidget.remove()},__setSlideWidgetPosition__:function(e){var t=this._innerArea.height();if(this._dateSelectFlg){var a=Math.round(.5*(t-this._startTimeWidget.height())),i=Math.round(.5*(t-this._endTimeWidget.height()));this.__jQuery_setCSS__(this._startTimeWidget,{top:a+"px"}),this.__jQuery_setCSS__(this._endTimeWidget,{top:i+"px"}),this.__setSlideWidgetXPosition__(this._startTimeWidget,this.dateStart,"r",e),this.__setSlideWidgetXPosition__(this._endTimeWidget,this.dateEnd,"l",e),this.__setSelectArea__(e)}if(this._dateNowFlg){var n=Math.round(.5*t-this._nowTimeWidget.height());this.__jQuery_setCSS__(this._nowTimeWidget,{top:n+"px"}),this.__setSlideWidgetXPosition__(this._nowTimeWidget,this.dateNow,"c",e)}},__setSelectArea__:function(e){var t=Math.round(.5*(this._innerArea.height()-this._selectAreaWidget.height())),a=this._innerArea.width(),i=Math.round(this.__timePosition__(this.dateStart,a)),n=Math.round(this.__timePosition__(this.dateEnd,a));null==e?this.__jQuery_setCSS__(this._selectAreaWidget,{left:i+"px",top:t+"px",width:n-i+"px",cursor:"move"}):this._selectAreaWidget.css("cursor","col-resize").animate({left:i+"px",top:t+"px",width:n-i+"px"},{duration:e,easing:"swing",queue:!1})},__setSlideWidgetXPosition__:function(e,t,a,i){if("l"==a)var n=0;if("r"==a)var n=e.width();if("c"==a)var n=.5*e.width();var r=Math.round(this.__timePosition__(t,this._innerArea.width())-n);null==i?e.css("left",r+"px"):e.animate({left:r+"px"},{duration:i,easing:"swing",queue:!1})},__setSlideWidgetMove__:function(){function e(e){return t(e.gesture,!0),!1}function t(e,t){if(e.stopPropagation(),t)var i=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);else var i=document.elementFromPoint(e.clientX,e.clientY);if("timeSlideStartDate"==i.id)a.__setStartTimeSlideWidgetMove__(e,t);else if("timeSlideEndDate"==i.id)a.__setEndTimeSlideWidgetMove__(e,t);else if("timeSlideNowDate"==i.id)a.__setNowTimeSlideWidgetMove__(e,t);else if("timeSlideSelect"==i.id)a.__setSelectAreaMove__(e,a,a._selectAreaWidget,t);else if(a._dateSelectFlg){var n=e.pageX-a._innerArea.offset().left,r=a._innerArea.width(),o=a.__timePosition__(a.dateStart,r),s=a.__timePosition__(a.dateEnd,r);o>n?a.__setStartTimeSlideWidgetTravel(e,t):n>s&&a.__setEndTimeSlideWidgetTravel(e,t)}else a._dateNowFlg&&a.__setNowTimeSlideWidgetTravel(e,t);return!1}var a=this;a._dateSelectFlg&&(this._startTimeWidget.on("contextmenu",function(){return!1}),this._endTimeWidget.on("contextmenu",function(){return!1}),this._selectAreaWidget.on("contextmenu",function(){return!1})),a._dateNowFlg&&this._nowTimeWidget.on("contextmenu",function(){return!1}),this._innerArea.on("contextmenu",function(){return!1}),this._innerArea.on("mousedown",t),this._innerAreaHammer&&this._innerAreaHammer.on("touch",e)},__setStartTimeSlideWidgetMove__:function(e,t){var a=this.dateLControl,i=this.dateEnd;this.__setSlideMove__(e,this,this._startTimeWidget,"dateStart",a,i,"r",1,t)},__setEndTimeSlideWidgetMove__:function(e,t){var a=this.dateStart,i=this.dateRControl;this.__setSlideMove__(e,this,this._endTimeWidget,"dateEnd",a,i,"l",-1,t)},__setNowTimeSlideWidgetMove__:function(e,t){if(this._dateSelectFlg)var a=this.dateStart,i=this.dateEnd;else var a=Math.max(this.dateMin,this.dateLControl),i=Math.min(this.dateMax,this.dateRControl);this.__setSlideMove__(e,this,this._nowTimeWidget,"dateNow",a,i,"c",0,t)},__setStartTimeSlideWidgetTravel:function(e,t){var a=this.dateMin,i=this.dateEnd;this.__setSlideTravel__(e,this,this._startTimeWidget,"dateStart",a,i,"r",t)},__setEndTimeSlideWidgetTravel:function(e,t){var a=this.dateStart,i=this.dateMax;this.__setSlideTravel__(e,this,this._endTimeWidget,"dateEnd",a,i,"l",t)},__setNowTimeSlideWidgetTravel:function(e,t){if(this._dateSelectFlg)var a=this.dateStart,i=this.dateEnd;else var a=this.dateMin,i=this.dateMax;this.__setSlideTravel__(e,this,this._nowTimeWidget,"dateNow",a,i,"c",t)},__setSelectAreaMove__:function(e,t,a,i){function n(e,i){if(i)var n=e.touches[0].pageX-d;else var n=e.pageX-d;0>l+n&&(n=-l),l+n>m&&(n=m-l),a.css("left",Math.round(l+n)+"px");var r=l+n,o=r+a.width();return t.dateStart=t.__timePositionInvert__(r,_),t.dateEnd=t.__timePositionInvert__(o,_),t.__setSlideWidgetXPosition__(t._startTimeWidget,t.dateStart,"r"),t.__setSlideWidgetXPosition__(t._endTimeWidget,t.dateEnd,"l"),t._dateNowFlg&&(t.dateNow-t.dateStart<0&&(t.dateNow=t.dateStart),t.dateNow-t.dateEnd>0&&(t.dateNow=t.dateEnd),t.__setSlideWidgetXPosition__(t._nowTimeWidget,t.dateNow,"c")),e.stopPropagation(),!1}function r(e){return $(document).off("mousemove"),$(document).off("mouseup"),t.__setTimeInterval__(),t.__updateLRControlWidget__(),e.stopPropagation(),!1}function o(e){return n(e.gesture,!0),!1}function s(e){return $(document).hammer().off("drag",o).off("release",s),t.__setTimeInterval__(),t.__updateLRControlWidget__(),e.gesture.stopPropagation(),!1}if(i)var d=e.touches[0].pageX;else var d=e.pageX;var l=this.__getLeftPos__(a),_=t._innerArea.width(),m=_-a.width();i&&$(document).hammer?$(document).hammer().on("drag",o).on("release",s):$(document).on("mousemove",n).on("mouseup",r),e.stopPropagation()},__setSlideMove__:function(e,t,a,i,n,r,o,s,d){function l(e,n){if(n)var r=e.touches[0].pageX-h;else var r=e.pageX-h;if(p>v+r&&(r=p-v),v+r>y&&(r=y-v),a.css("left",Math.round(v+r-g)+"px"),t[i]=t.__timePositionInvert__(v+r,f),t._dateSelectFlg&&t.__setSelectArea__(),t._dateNowFlg&&s){var o=t.dateNow-t[i];if(0>o*s){var d=t._nowTimeWidget.width();t._nowTimeWidget.css("left",Math.round(v+r-.5*d)+"px"),t.dateNow=t[i]}}return e.stopPropagation(),!1}function _(e){return $(document).off("mousemove"),$(document).off("mouseup"),t[i]=t.__timePositionInvert__(t.__getLeftPos__(a)+g,f),t.__setTimeInterval__(),t.__updateLRControlWidget__(),e.stopPropagation(),!1}function m(e){return l(e.gesture,!0),!1}function c(e){return $(document).hammer().off("drag",m).off("release",c),t[i]=t.__timePositionInvert__(t.__getLeftPos__(a)+g,f),t.__setTimeInterval__(),t.__updateLRControlWidget__(),e.gesture.stopPropagation(),!1}if(d)var h=e.touches[0].pageX;else var h=e.pageX;var u=a.width();if("l"==o)var g=0;if("r"==o)var g=u;if("c"==o)var g=.5*u;var v=this.__getLeftPos__(a)+g,f=t._innerArea.width(),p=Math.round(t.__timePosition__(n,f)),y=Math.round(t.__timePosition__(r,f));d&&$(document).hammer?$(document).hammer().on("drag",m).on("release",c):$(document).on("mousemove",l).on("mouseup",_),e.stopPropagation()},__setSlideTravel__:function(e,t,a,i,n,r,o,s){if(s)var d=e.touches[0].pageX-t._innerArea.offset().left;else var d=e.pageX-t._innerArea.offset().left;var l=a.width();if("l"==o)var _=0;if("r"==o)var _=l;if("c"==o)var _=.5*l;var m=t._innerArea.width(),c=Math.round(t.__timePosition__(n,m)),h=Math.round(t.__timePosition__(r,m));if(c>d&&(d=c),d>h&&(d=h),t[i]=t.__timePositionInvert__(d,m),a.animate({left:d-_+"px"},{duration:300,easing:"swing",queue:!1}),t._dateSelectFlg){var u=t.__timePosition__(t.dateStart,m),g=t.__timePosition__(t.dateEnd,m);t._selectAreaWidget.animate({left:u+"px",width:g-u+"px"},{duration:300,easing:"swing",queue:!1})}return t.__updateLRControlWidget__(),!1},__addEventListener__:function(e,t,a,i){if(null==a)null!=this._eventFunc[e][0]&&(this._dateSelectFlg&&(this.__unsetEventFunc__(e,this._startTimeWidget),this.__unsetEventFunc__(e,this._endTimeWidget),this.__unsetEventFunc__(e,this._selectAreaWidget)),this._dateNowFlg&&this.__unsetEventFunc__(e,this._nowTimeWidget),this.__unsetEventFunc__(e,this._innerArea)),this._eventFunc[e][0]=t,this._dateSelectFlg&&(this.__setEventFunc__(this._startTimeWidget,t,e),this.__setEventFunc__(this._endTimeWidget,t,e),this.__setEventFunc__(this._selectAreaWidget,t,e)),this._dateNowFlg&&this.__setEventFunc__(this._nowTimeWidget,t,e),this.__setEventFunc__(this._innerArea,t,e);else{switch(a){case"dateStart":var n=this._startTimeWidget,r=this._dateSelectFlg;break;case"dateEnd":var n=this._endTimeWidget,r=this._dateSelectFlg;break;case"dateNow":var n=this._nowTimeWidget,r=this._dateNowFlg;break;case"selectArea":var n=this._SelectAreaWidget,r=this._dateSelectFlg;break;case"innerArea":var n=this._innerArea,r=!0}null!=this._eventFunc[e][a]&&r&&this.__unsetEventFunc__(e,n),this._eventFunc[e][a]=t,r&&this.__setEventFunc__(n,t,e)}},__removeEventListener__:function(e,t,a){if(null==t)this._dateSelectFlg&&(this.__unsetEventFunc__(e,this._startTimeWidget),this.__unsetEventFunc__(e,this._endTimeWidget),this.__unsetEventFunc__(e,this._selectAreaWidget)),this._dateNowFlg&&this.__unsetEventFunc__(e,this._nowTimeWidget);else{switch(t){case"dateStart":var i=this._startTimeWidget;break;case"dateEnd":var i=this._endTimeWidget;break;case"dateNow":var i=this._nowTimeWidget;break;case"selectArea":var i=this._SelectAreaWidget}this.__unsetEventFunc__(e,i)}},__setEventFunc__:function(e,t,a,i){function n(a){function i(){$(document).off("mousemove",t).off("mouseup",i)}function n(){$(document).hammer().off("drag",function(e){t(e.gesture.touches[0])}).off("release",n)}if("touch"==a.type){a=a.gesture.touches[0];var r=document.elementFromPoint(a.clientX,a.clientY);r.id==e.attr("id")&&$(document).hammer().on("drag",function(e){t(e.gesture.touches[0])}).on("release",n)}else{var r=document.elementFromPoint(a.clientX,a.clientY);r.id==e.attr("id")&&$(document).on("mousemove",t).on("mouseup",i)}}function r(a){function i(e){t(e),$(document).off("mouseup",i)}function n(e){t(e.gesture.touches[0]),$(document).hammer().off("release",n)}if("touch"==a.type){a=a.gesture.touches[0];var r=document.elementFromPoint(a.clientX,a.clientY);r.id==e.attr("id")&&$(document).hammer().on("release",n)}else{var r=document.elementFromPoint(a.clientX,a.clientY);r.id==e.attr("id")&&$(document).on("mouseup",i)}}function o(a){"touch"==a.type&&(a=a.gesture.touches[0]);var i=document.elementFromPoint(a.clientX,a.clientY);i.id==e.attr("id")&&t(a)}if(i)"change"==a||"mousemove"==a?(this._innerArea.off("mousedown",n),this._innerAreaHammer&&this._innerAreaHammer.off("touch",n)):"mouseup"==a?(this._innerArea.off("mousedown",r),this._innerAreaHammer&&this._innerAreaHammer.off("touch",r)):("mousedown"==a||"click"==a)&&(this._innerArea.off("mousedown",o),this._innerAreaHammer&&this._innerAreaHammer.off("touch",o));else{if(null==t)return;"change"==a||"mousemove"==a?(this._innerArea.on("mousedown",n),this._innerAreaHammer&&this._innerAreaHammer.on("touch",n)):"mouseup"==a?(this._innerArea.on("mousedown",r),this._innerAreaHammer&&this._innerAreaHammer.on("touch",r)):("mousedown"==a||"click"==a)&&(this._innerArea.on("mousedown",o),this._innerAreaHammer&&this._innerAreaHammer.on("touch",o))}},__unsetEventFunc__:function(e,t){this.__setEventFunc__(t,null,e,!0)},__updateEventFunc__:function(e){this._dateSelectFlg||null==this.dateStart||null==this.dateEnd||(this.__setEventFunc__(this._startTimeWidget,this._eventFunc[e][0]),this.__setEventFunc__(this._startTimeWidget,this._eventFunc[e].dateStart),this.__setEventFunc__(this._endTimeWidget,this._eventFunc[e][0]),this.__setEventFunc__(this._endTimeWidget,this._eventFunc[e].dateEnd),this.__setEventFunc__(this._selectAreaWidget,this._eventFunc[e][0]),this.__setEventFunc__(this._selectAreaWidget,this._eventFunc[e].SelectArea)),this._dateNowFlg||null==this.dateNow||(this.__setEventFunc__(this._nowTimeWidget,this._eventFunc[e][0]),this.__setEventFunc__(this._nowTimeWidget,this._eventFunc[e].dateNow))},__makeAxis__:function(e){this._axisArea=$("#"+e),this.__jQuery_setCSS__(this._axisArea,{width:"100%",clear:"both"});var t=this.__getLeftPos__($("#timeSlideMainContentsWrap")),a=this._innerArea.width();this.__jQuery_setCSS__(this._axisArea,{width:"100%"});var i=d3.select("#"+e).append("svg").attr("id","timeSlideAxisSVG").attr("class","timeSlideAxis").attr("width","110%").attr("height","100%"),n=d3.time.scale().domain([this.dateLControl,this.dateRControl]).range([t,t+a]),r=d3.svg.axis().scale(n).orient(this.axisTicksOrient).ticks(this.axisTicksNum).tickFormat(this.__timeFormat__(this.axisTicksTxtFormat));i.append("g").attr("id","timeSlideXAxis").attr("class","timeSlideAxis").call(r);var o=d3.select("#timeSlideAxis").selectAll("text");null!=this.axisTicksTxtDX&&o.attr("dx",this.axisTicksTxtDX),null!=this.axisTicksTxtDY&&o.attr("dy",this.axisTicksTxtDY),0!=this.axisTicksTxtRotate&&o.attr("transform","rotate("+this.axisTicksTxtRotate+")"),null!=this.axisTicksTxtAnchor&&o.style("text-anchor",this.axisTicksTxtAnchor)},__updateAxis__:function(e){var t=this.__getLeftPos__($("#timeSlideMainContentsWrap")),a=this._innerArea.width(),i=d3.time.scale().domain([this.dateLControl,this.dateRControl]).range([t,t+a]),n=d3.svg.axis().scale(i).orient(this.axisTicksOrient).ticks(this.axisTicksNum).tickFormat(this.__timeFormat__(this.axisTicksTxtFormat));null==e?d3.select("#timeSlideXAxis").call(n):d3.select("#timeSlideXAxis").transition().duration(e).call(n);var r=d3.select("#timeSlideAxis").selectAll("text");null!=this.axisTicksTxtDX&&r.attr("dx",this.axisTicksTxtDX),null!=this.axisTicksTxtDY&&r.attr("dy",this.axisTicksTxtDY),0!=this.axisTicksTxtRotate&&r.attr("transform","rotate("+this.axisTicksTxtRotate+")"),null!=this.axisTicksTxtAnchor&&r.style("text-anchor",this.axisTicksTxtAnchor)},__makeCalendar__:function(e,t,a,i,n){null!=a&&0>t-a&&(t=a),null!=i&&t-i>0&&(t=i);var r=t.getFullYear(),o=t.getMonth(),s=t.getDate();if(null!=a)var d=a.getFullYear(),l=a.getMonth(),_=a.getDate();else var d=r-20,l=o,_=0;if(null!=i)var m=i.getFullYear(),c=i.getMonth(),h=i.getDate();else var m=r+20,c=o+1,h=0;var u=$("#"+e);this.__jQuery_setCSS__(u,{display:"block"});var g=$(this.__jQuery_create__("table",{id:"timeSlideCalendarTable","class":"timeSlideCalendar"}));if(u.append(g),this._calendar[e]={widget:u,table:g,yy:r,mm:o,dd:s,yyon:r,mmon:o,ymin:d,mmin:l,dmin:_,ymax:m,mmax:c,dmax:h,hour:0,min:0,sec:0,dtime:n,onchangeFunc:null,onchangeDateFunc:null,onchangeTimeFunc:null,flgFirst:!0},this.__makeCalendarCaption__(e),this.__makeCalendarBody__(e,r,o,s),this.__setCalendarCaptionButton__(e),this._calendar[e].timeFlg=n[3]||n[4]||n[5],this._calendar[e].timeFlg){var v=this;this.__makeCalendarTimeForm__(e,t),this.__setCalendarTimeFormButton__(e,v)}this._calendar[e].flgFirst=!1},__makeCalendarCaption__:function(e){var t=$(this.__jQuery_create__("caption",{id:"timeSlideCalendarCaption","class":"timeSlideCalendar"}));this._calendar[e].table.append(t);var a=$(this.__jQuery_create__("input",{id:"timeSlideCalendarCaptionStart",value:"|<"})),i=$(this.__jQuery_create__("input",{id:"timeSlideCalendarCaptionPrevious",value:"<"})),n=$(this.__jQuery_create__("input",{id:"timeSlideCalendarCaptionNext",value:">"})),r=$(this.__jQuery_create__("input",{id:"timeSlideCalendarCaptionEnd",value:">|"})),o={"class":"timeSlideCalendar timeSlideCalendarCaption timeSlideCalendarButton",type:"button"};this.__jQuery_setAttr__(a,o),this.__jQuery_setAttr__(i,o),this.__jQuery_setAttr__(n,o),this.__jQuery_setAttr__(r,o);var s=$(this.__jQuery_create__("select",{id:"timeSlideCalendarCaptionSelectYear","class":"timeSlideCalendar timeSlideCalendarCaption selectYear"})),d=$(this.__jQuery_create__("select",{id:"timeSlideCalendarCaptionSelectMonth","class":"timeSlideCalendar timeSlideCalendarCaption selectMonth"}));t.append(a),t.append(i),t.append(s),t.append("/"),t.append(d),t.append(n),t.append(r);for(var l=this._calendar[e].yyon,_=this._calendar[e].mmon,m=this._calendar[e].ymin,c=this._calendar[e].mmin,h=new Date(this._calendar[e].ymax,this._calendar[e].mmax),u=new Date(m,c),g=0;0>=u-h;){var v=this.__dateFormat__(u,"yyyy"),f=$(this.__jQuery_create__("option",{value:v}));f.html(v),s.append(f),m==l&&s.prop("selectedIndex",g),g++;var u=new Date(m+1,0);m=u.getFullYear()}for(var c=0;12>c;c++){v=c+1;var f=$(this.__jQuery_create__("option",{value:v}));f.html(v),d.append(f),c==_&&d.prop("selectedIndex",c)}l==this._calendar[e].ymax&&_==this._calendar[e].mmax&&n.attr("disabled","disabled"),(l!=this._calendar[e].ymax||_!=this._calendar[e].mmax)&&n.removeAttr("disabled"),l==this._calendar[e].ymin&&_==this._calendar[e].mmin&&i.attr("disabled","disabled"),(l!=this._calendar[e].ymin||_!=this._calendar[e].mmin)&&i.removeAttr("disabled")},__makeCalendarBody__:function(e,t,a,i){var n=this._calendar[e].ymin,r=this._calendar[e].mmin,o=this._calendar[e].dmin,s=this._calendar[e].ymax,d=this._calendar[e].mmax,l=this._calendar[e].dmax;this._calendar[e].flgFirst||this._calendar[e].table.find("tr").remove();var _=!1;(t%4==0&&t%100!=0||t%400==0)&&(_=!0);for(var m=new Array(31,28+_,31,30,31,30,31,31,30,31,30,31),c=new Array("SUN","MON","TUE","WED","THU","FRI","SAT"),h=0,u=0;a>u;u++)h+=m[u];var g=Math.floor((365.2425*t+h)%7),v=-1,f=100;n>t||t==n&&r>a?v=100:t==n&&a==r&&(v=o),t>s||t==s&&a>d?f=-1:t==s&&a==d&&(f=l);var p=0,y=$(this.__jQuery_create__("tr"));for(this._calendar[e].table.append(y),u=0;7>u;u++){var S=$(this.__jQuery_create__("td"));S.html(c[u]),y.append(S)}var y=$(this.__jQuery_create__("tr"));for(this._calendar[e].table.append(y),u=0;g>u;u++,p++){var S=$(this.__jQuery_create__("td"));y.append(S)}for(u=1;u<=m[a];u++){var S=$(this.__jQuery_create__("td"));if(i==u?S.attr("class","daySet"):v>u||u>f?S.attr("class","dayUnSelect"):S.attr("class","daySelect"),S.html(u),y.append(S),p++,p>6){var y=$(this.__jQuery_create__("tr"));this._calendar[e].table.append(y),p=0}}for(u=p;u>6;u++){var S=$(this.__jQuery_create__("td"));y.append(S)}},__makeCalendarTimeForm__:function(e,t){var a=$(this.__jQuery_create__("tr",{"class":"timeTr"})),i=$(this.__jQuery_create__("td")),n=$(this.__jQuery_create__("td")),r=$(this.__jQuery_create__("td",{colspan:3})),o=$(this.__jQuery_create__("td")),s=$(this.__jQuery_create__("td"));if(this._calendar[e].table.append(a),a.append(i),a.append(n),a.append(r),a.append(o),a.append(s),this._calendar[e].timeForm=$(this.__jQuery_create__("input",{id:"timeSlideCalendarTimeForm","class":"time",type:"text"})),this._calendar[e].timeFormPrev=$(this.__jQuery_create__("input",{id:"timeSlideCalendarTimePrev","class":"timePrev",type:"button",value:"<"})),this._calendar[e].timeFormNext=$(this.__jQuery_create__("input",{id:"timeSlideCalendarTimeNext","class":"timeNext",type:"button",value:">"})),n.append(this._calendar[e].timeFormPrev),r.append(this._calendar[e].timeForm),o.append(this._calendar[e].timeFormNext),t)this._calendar[e].hour=t.getHours(),this._calendar[e].min=t.getMinutes(),this._calendar[e].sec=t.getSeconds();else var t=new Date(this._calendar[e].yy,this._calendar[e].mm,this._calendar[e].dd,this._calendar[e].hour,this._calendar[e].min,this._calendar[e].sec);var d="HH:mm";this._calendar[e].dtime[5]>0&&(d="HH:mm:ss"),0==this._calendar[e].dtime[3]&&0==this._calendar[e].dtime[4]&&0==this._calendar[e].dtime[5]&&this._calendar[e].timeForm.attr("readonly",!0),this._calendar[e].timeForm.val(this.__dateFormat__(t,d))},__setCalendarCaptionButton__:function(e){var t=this._calendar[e].table.find("#timeSlideCalendarCaptionStart"),a=this._calendar[e].table.find("#timeSlideCalendarCaptionPrevious"),i=this._calendar[e].table.find("#timeSlideCalendarCaptionNext"),n=this._calendar[e].table.find("#timeSlideCalendarCaptionEnd"),r=this._calendar[e].table.find("#timeSlideCalendarCaptionSelectYear"),o=this._calendar[e].table.find("#timeSlideCalendarCaptionSelectMonth"),s=this;i.click(function(t){t.stopPropagation(),s._calendar[e].mmon=s._calendar[e].mmon+1,s.__resetCalendarBody__(e,s)}),a.click(function(t){t.stopPropagation(),s._calendar[e].mmon=s._calendar[e].mmon-1,s.__resetCalendarBody__(e,s)}),t.click(function(t){t.stopPropagation(),s._calendar[e].yyon=s._calendar[e].ymin,s._calendar[e].mmon=s._calendar[e].mmin,s.__resetCalendarBody__(e,s)}),n.click(function(t){t.stopPropagation(),s._calendar[e].yyon=s._calendar[e].ymax,s._calendar[e].mmon=s._calendar[e].mmax,s.__resetCalendarBody__(e,s)}),r.change(function(){s._calendar[e].yyon=s._calendar[e].ymin+this.selectedIndex,s.__resetCalendarBody__(e,s)}),o.change(function(){s._calendar[e].mmon=this.selectedIndex,s.__resetCalendarBody__(e,s)}),s.__setDaySelectButton__(e,s._calendar[e].yyon,s._calendar[e].mmon,s)},__resetCalendarBody__:function(e,t){var a=new Date(t._calendar[e].yyon,t._calendar[e].mmon),i=a.getFullYear(),n=a.getMonth();t._calendar[e].yyon=i,t._calendar[e].mmon=n;var r=-1;t._calendar[e].yy==i&&t._calendar[e].mm==n&&(r=t._calendar[e].dd),t.__makeCalendarBody__(e,i,n,r),i==t._calendar[e].ymax&&n==t._calendar[e].mmax&&this._calendar[e].table.find("#timeSlideCalendarCaptionNext").attr("disabled","disabled"),(i!=t._calendar[e].ymax||n!=t._calendar[e].mmax)&&this._calendar[e].table.find("#timeSlideCalendarCaptionNext").removeAttr("disabled"),i==t._calendar[e].ymin&&n==t._calendar[e].mmin&&t._calendar[e].table.find("#timeSlideCalendarCaptionPrevious").attr("disabled","disabled"),(i!=t._calendar[e].ymin||n!=t._calendar[e].mmin)&&t._calendar[e].table.find("#timeSlideCalendarCaptionPrevious").removeAttr("disabled");var o=i-t._calendar[e].ymin;t._calendar[e].table.find("#timeSlideCalendarCaptionSelectYear").prop("selectedIndex",o),t._calendar[e].table.find("#timeSlideCalendarCaptionSelectMonth").prop("selectedIndex",n),t.__setDaySelectButton__(e,i,n,t),this._calendar[e].timeFlg&&(t.__makeCalendarTimeForm__(e),t.__setCalendarTimeFormButton__(e,t))},__setDaySelectButton__:function(e,t,a,i){i._calendar[e].table.find("td.daySelect").click(function(n){n.stopPropagation();var r=Number(this.innerHTML);i._calendar[e].yy=t,i._calendar[e].mm=a,i._calendar[e].dd=r,i._calendar[e].yyon=t,i._calendar[e].mmon=a;var o=i._calendar[e].hour,s=i._calendar[e].min,d=i._calendar[e].sec;i.__resetCalendarBody__(e,i);var l=new Date(t,a,r,o,s,d);null!=i._calendar[e].onchangeFunc&&i._calendar[e].onchangeFunc(l),null!=i._calendar[e].onchangeDateFunc&&i._calendar[e].onchangeDateFunc(l)})},__setCalendarTimeFormButton__:function(e,t){function a(e,t){var a=e.split(":"),i=Number(a[0]),n=Number(a[1]),r=0;3==a.length&&(r=Number(a[2]));var o=1e3*(r+60*(n+60*i));return new Date(t-0+o)}function i(e,t,a){var i=a._calendar[e].yy,n=a._calendar[e].mm,r=a._calendar[e].dd,o=a._calendar[e].hour,s=a._calendar[e].min,d=a._calendar[e].sec;i+=t*a._calendar[e].dtime[0],n+=t*a._calendar[e].dtime[1],r+=t*a._calendar[e].dtime[2],o+=t*a._calendar[e].dtime[3],s+=t*a._calendar[e].dtime[4],d+=t*a._calendar[e].dtime[5];var l=new Date(i,n,r,o,s,d);l-a.dateMin<0&&(l=a.dateMin),l-a.dateMax>0&&(l=a.dateMax),a._calendar[e].yy=l.getFullYear(),a._calendar[e].mm=l.getMonth()+1,a._calendar[e].dd=l.getDate(),a._calendar[e].hour=l.getHours(),a._calendar[e].min=l.getMinutes(),a._calendar[e].sec=l.getSeconds(),a.__updateCalendar__(e,l),null!=a._calendar[e].onchangeFunc&&a._calendar[e].onchangeFunc(l),null!=a._calendar[e].onchangeTimeFunc&&a._calendar[e].onchangeTimeFunc(l)}this._calendar[e].timeForm.change(function(i){i.stopPropagation();var n=t._calendar[e].yy,r=t._calendar[e].mm,o=t._calendar[e].dd,s=new Date(n,r,o),d=a(this.value,s);d=t.__checkTimeInterval__(d,s,t._calendar[e].dtime),d-t.dateMin<0&&(d=t.dateMin),d-t.dateMax>0&&(d=t.dateMax),t._calendar[e].hour=d.getHours(),t._calendar[e].min=d.getMinutes(),t._calendar[e].sec=d.getSeconds(),t.__updateCalendar__(e,d),null!=t._calendar[e].onchangeFunc&&t._calendar[e].onchangeFunc(d),null!=t._calendar[e].onchangeTimeFunc&&t._calendar[e].onchangeTimeFunc(d)}),this._calendar[e].timeFormPrev.click(function(a){a.stopPropagation(),i(e,-1,t)}),this._calendar[e].timeFormNext.click(function(a){a.stopPropagation(),i(e,1,t)})},__checkTimeInterval__:function(e,t,a){var i=e-t,n=1e3*(a[5]+60*(a[4]+60*a[3])),r=Math.round(i/n);return new Date(t-0+r*n)},__updateCalendar__:function(e,t){this._calendar[e].yyon=t.getFullYear(),this._calendar[e].mmon=t.getMonth(),this._calendar[e].yy=t.getFullYear(),this._calendar[e].mm=t.getMonth(),this._calendar[e].dd=t.getDate(),this._calendar[e].hour=t.getHours(),this._calendar[e].min=t.getMinutes(),this._calendar[e].sec=t.getSeconds(),this.__resetCalendarBody__(e,this)},__timePosition__:function(e,t){var a=(e-this.dateLControl)/(this.dateRControl-this.dateLControl);return t?t*a:a},__timePositionInvert__:function(e,t){var a=this.dateLControl-0+e/t*(this.dateRControl-this.dateLControl);return new Date(a)},__getLeftPos__:function(e){var t=parseInt(e.css("left"));return isNaN(t)&&(t=e.position().left),t},__dateFormat__:function(e,t){function a(e,t){return new Array(t-(""+e).length+1).join("0")+e}if(null==e)return null;for(var i,n,r=t,o=new Array("SUN","MON","TUE","WED","THU","FRI","SAT"),s=["yyyy","MM","ddd","dd","HH","mm","ss","fff"],d=0;d<s.length;d++)if(i=s[d],r.indexOf(s[d])>-1){switch(d){case 0:n=e.getFullYear();break;case 1:n=a(e.getMonth()+1,2);break;case 2:n=o[e.getDay()];break;case 3:n=a(e.getDate(),2);break;case 4:n=a(e.getHours(),2);break;case 5:n=a(e.getMinutes(),2);break;case 6:n=a(e.getSeconds(),2);break;case 7:n=a(e.getMilliseconds(),3)}r=r.replace(s[d],n)}return r},__dateParse__:function(e,t,a){var i=[0,0,1,0,0,0,0];a&&(i[0]=a.getFullYear(),i[1]=a.getMonth(),i[2]=a.getDate(),i[3]=a.getHours(),i[4]=a.getMinutes(),i[5]=a.getSeconds(),i[6]=a.getMilliseconds());for(var n,r=["yyyy","MM","dd","HH","mm","ss","fff"],o=0;o<r.length;o++){var s=r[o];n=t.indexOf(s),n>-1&&(i[o]=e.substr(n,s.length),1==o&&(i[o]=parseInt(i[o],10)-1))}var d=new Date(i[0],i[1],i[2],i[3],i[4],i[5],i[6]);return"Invalid Date"==d&&(d=null),d},__jQuery_create__:function(){if(0==arguments.length)return[];var e=arguments[0]||{},t=null,a=null,i=null;if(null==e&&(e=""),e.constructor==String){if(arguments.length>1){var n=arguments[1];if(n.constructor==String)return t=document.createTextNode(e),a=[],a.push(t),i=this.__jQuery_create__.apply(null,Array.prototype.slice.call(arguments,1)),a=a.concat(i);t=document.createElement(e);var n=arguments[1];for(var r in n)jQuery(t).attr(r,n[r]);var o=arguments[2];return o=this.__jQuery_create__.apply(null,o),jQuery(t).append(o),arguments.length>3?(i=this.__jQuery_create__.apply(null,Array.prototype.slice.call(arguments,3)),[t].concat(i)):t}return document.createElement(e)}return a=[],a.push(e),i=this.__jQuery_create__.apply(null,Array.prototype.slice.call(arguments,1)),a=a.concat(i)},__jQuery_setCSS__:function(e,t){for(var a in t)e.css(a,t[a])},__jQuery_setAttr__:function(e,t){for(var a in t)e.attr(a,t[a])},__setTimeToArray__:function(e){return[e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()]},__setTimeArrayToVar__:function(e){for(var t,a=0,i=1,n=0,r=0,o=0,s=0;s<e.length;s++)switch(s){case 0:t=e[s];break;case 1:a=e[s];break;case 2:i=e[s];break;case 3:n=e[s];break;case 4:r=e[s];break;case 5:o=e[s]}return new Date(t,a,i,n,r,o)},__setTimeDtPlus__:function(e,t,a){for(var i=this.__setTimeToArray__(e),n=0;n<i.length;n++)i[n]=i[n]+t[n]*a;return this.__setTimeArrayToVar__(i)},__setTimeDtDivide__:function(e,t,a){if(0==a[0]&&0==a[1]){var i=1e3*(a[5]+60*(a[4]+60*(a[3]+24*a[2])));return(t-e)/i}var i=12*a[0]+a[1],n=12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth());return n/i},__setTimeIntervalSet__:function(e,t,a){var i=Math.round(this.__setTimeDtDivide__(e,t,a));return this.__setTimeDtPlus__(e,a,i)}};var saveTs,saveTe,flgSaveAnimation,filenameFlg,first=!0,saveMode,fileFormats=["WebM","GIF"],fileExtensions=["webm","gif"],fileFormatNum=0;